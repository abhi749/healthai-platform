<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthAI - Privacy-First Health Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 40px;
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area.dragover {
            border-color: #4c51bf;
            background: #e6f3ff;
        }
        
        .upload-area h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .upload-area p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .privacy-info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .privacy-info h4 {
            color: #1890ff;
            margin-bottom: 10px;
        }
        
        .processing-status {
            display: none;
            background: #fff7e6;
            border: 1px solid #ffd666;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .document-preview {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .sanitization-log {
            background: #f0f8f0;
            border: 1px solid #52c41a;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px auto;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
        }
        
        .analyze-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: #f8f9ff;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .result h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .analysis-content {
            white-space: pre-line;
            line-height: 1.8;
            background: white;
            padding: 20px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            font-style: italic;
            padding: 20px;
        }
        
        .error {
            background: #ffe6e6;
            border: 2px solid #ff6b6b;
            color: #d63031;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            color: white;
        }
        
        .feature-card h3 {
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .smart-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-card {
                padding: 20px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü©∫ HealthAI</h1>
            <p>Privacy-First AI Health Analysis ‚Ä¢ Universal Medical Parameter Recognition</p>
        </div>
        
        <div class="main-card">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('upload')">üìÑ Smart Upload <span class="smart-badge">AI-Powered</span></button>
                <button class="tab" onclick="switchTab('manual')">‚úèÔ∏è Manual Entry</button>
            </div>
            
            <!-- Smart Document Upload Tab -->
            <div class="tab-content active" id="upload-tab">
                <div class="privacy-info">
                    <h4>üß† Universal Health Parameter Recognition</h4>
                    <p><strong>AI-powered smart extraction</strong> recognizes ANY medical parameter from your documents - lab results, DEXA scans, hormone panels, fitness data, genetic reports, and more. Personal identifiers are automatically detected and removed on your device before AI processing.</p>
                </div>
                
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <h3>üìÅ Drop Any Health Document Here</h3>
                    <p>üî¨ Lab Results ‚Ä¢ ü¶¥ DEXA/Bone Density ‚Ä¢ üíâ Hormone Panels<br>
                       üèÉ Fitness Reports ‚Ä¢ üß¨ Genetic Analysis ‚Ä¢ ü©∏ Blood Work<br>
                       üìä Body Composition ‚Ä¢ üíä Metabolic Panels ‚Ä¢ Any Health Data<br>
                       <strong>Maximum file size: 25MB ‚Ä¢ Format: PDF</strong></p>
                    <button class="upload-btn">Choose File</button>
                    <input type="file" id="fileInput" class="file-input" accept=".pdf" onchange="handleFileSelect(event)">
                </div>
                
                <div class="processing-status" id="processingStatus">
                    <h4>ü§ñ AI Processing Your Document...</h4>
                    <div id="processingSteps"></div>
                </div>
                
                <div class="document-preview" id="documentPreview" style="display: none;">
                    <h4>üìÑ Document Content Preview:</h4>
                    <div id="documentContent"></div>
                </div>
                
                <div class="sanitization-log" id="sanitizationLog" style="display: none;">
                    <h4>üîí Smart Privacy Protection & Parameter Extraction:</h4>
                    <div id="sanitizationSteps"></div>
                </div>
                
                <div id="documentResult"></div>
            </div>
            
            <!-- Manual Entry Tab -->
            <div class="tab-content" id="manual-tab">
                <div class="input-group">
                    <label for="healthData">Enter Your Health Data for Analysis:</label>
                    <textarea 
                        id="healthData" 
                        placeholder="Example: Cholesterol Total: 240 mg/dL, HDL: 35 mg/dL, LDL: 180 mg/dL, Triglycerides: 300 mg/dL, Glucose: 110 mg/dL, Blood Pressure: 140/90"
                    >Cholesterol Total: 240 mg/dL, HDL: 35 mg/dL, LDL: 180 mg/dL, Triglycerides: 300 mg/dL, Glucose: 110 mg/dL, Blood Pressure: 140/90, Age: 45, Weight: 180 lbs</textarea>
                </div>
                
                <button class="analyze-btn" onclick="testAI()" id="analyzeBtn">
                    üß† Analyze Health Data
                </button>
                
                <div id="result"></div>
            </div>
        </div>
        
        <div class="features">
            <div class="feature-card">
                <h3>üß† Smart AI Recognition</h3>
                <p>Automatically identifies ANY medical parameter - from basic labs to specialized tests</p>
            </div>
            <div class="feature-card">
                <h3>üîí Complete Privacy</h3>
                <p>Personal identifiers detected & removed on your device before AI processing</p>
            </div>
            <div class="feature-card">
                <h3>‚ö° Universal Support</h3>
                <p>Works with all health documents - evolving platform that gets smarter over time</p>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Drag and drop functionality
        const uploadArea = document.getElementById('uploadArea');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.add('dragover');
            }, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.remove('dragover');
            }, false);
        });
        
        uploadArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }
        
        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }
        
        // File processing functionality
        function handleFiles(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            
            // Validate file
            if (file.type !== 'application/pdf') {
                alert('Please upload a PDF file only.');
                return;
            }
            
            if (file.size > 25 * 1024 * 1024) { // 25MB
                alert('File size must be less than 25MB.');
                return;
            }
            
            processDocument(file);
        }
        
        // Enhanced smart document processing
        async function processDocument(file) {
            const processingStatus = document.getElementById('processingStatus');
            const processingSteps = document.getElementById('processingSteps');
            const documentPreview = document.getElementById('documentPreview');
            const documentContent = document.getElementById('documentContent');
            const sanitizationLog = document.getElementById('sanitizationLog');
            const sanitizationSteps = document.getElementById('sanitizationSteps');
            
            // Show processing status
            processingStatus.style.display = 'block';
            
            try {
                // Step 1: Read PDF
                processingSteps.innerHTML = '‚è≥ Step 1: Reading PDF document...';
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Step 2: Extract text (simulated OCR)
                processingSteps.innerHTML += '<br>‚è≥ Step 2: Extracting text with OCR...';
                await new Promise(resolve => setTimeout(resolve, 1200));
                
                // For demo, simulate different document types based on filename
                const fileName = file.name.toLowerCase();
                let simulatedText;
                
                if (fileName.includes('dexa') || fileName.includes('bone')) {
                    simulatedText = `
DEXA SCAN RESULTS - BONE DENSITY ANALYSIS
Patient: Sarah Johnson
DOB: 07/22/1975  
Address: 456 Oak Street, Springfield, IL 62701
Phone: (217) 555-9876

SCAN DATE: September 15, 2024
TECHNICIAN: Dr. Martinez

BONE MINERAL DENSITY RESULTS:
Lumbar Spine L1-L4: 0.952 g/cm¬≤ (T-score: -1.8, Z-score: -0.9)
Left Femoral Neck: 0.789 g/cm¬≤ (T-score: -2.1, Z-score: -1.2)  
Total Hip: 0.821 g/cm¬≤ (T-score: -1.9, Z-score: -1.0)
Left Forearm: 0.645 g/cm¬≤ (T-score: -1.5, Z-score: -0.8)

BODY COMPOSITION:
Total Body Weight: 145.2 lbs
Lean Mass: 98.4 lbs
Fat Mass: 42.1 lbs  
Body Fat Percentage: 29.0%
Visceral Fat: 0.8 lbs
Bone Mineral Content: 4.7 lbs

DIAGNOSIS: Osteopenia (Low Bone Density)
`;
                } else if (fileName.includes('hormone') || fileName.includes('thyroid')) {
                    simulatedText = `
COMPREHENSIVE HORMONE PANEL
Patient Name: Michael Rodriguez
Date of Birth: 12/03/1982
SSN: ***-**-7890
Address: 789 Pine Ave, Denver, CO 80202

TEST DATE: August 28, 2024
FASTING: Yes (12 hours)

THYROID FUNCTION:
TSH: 4.2 mIU/L (Normal: 0.4-4.0)
Free T4: 1.1 ng/dL (Normal: 0.8-1.8)
Free T3: 2.8 pg/mL (Normal: 2.3-4.2)
Reverse T3: 18 ng/dL (Normal: 8-25)
Anti-TPO Antibodies: 45 IU/mL (Normal: <35)

REPRODUCTIVE HORMONES:
Testosterone Total: 320 ng/dL (Normal: 300-1000)
Testosterone Free: 8.2 pg/mL (Normal: 9-30)
SHBG: 42 nmol/L (Normal: 10-57)
LH: 4.1 mIU/mL (Normal: 1.7-8.6)
FSH: 3.8 mIU/mL (Normal: 1.5-12.4)

ADRENAL FUNCTION:
Cortisol AM: 18.5 Œºg/dL (Normal: 6-23)
DHEA-S: 180 Œºg/dL (Normal: 102-416)
Aldosterone: 8.2 ng/dL (Normal: 4-31)
`;
                } else if (fileName.includes('fitness') || fileName.includes('activity')) {
                    simulatedText = `
FITNESS & ACTIVITY REPORT
User: Jennifer Chen (ID: FC-2024-8901)
Email: j.chen@email.com
Device: Apple Watch Series 9
Reporting Period: August 1-31, 2024

DAILY AVERAGES:
Steps: 12,847 steps/day
Active Calories: 487 cal/day
Total Calories: 2,156 cal/day
Distance: 6.2 miles/day
Flights Climbed: 18 floors/day

EXERCISE METRICS:
Workout Frequency: 5.2 sessions/week
Average Workout Duration: 47 minutes
Heart Rate Zones:
  - Zone 1 (50-60%): 28% of workout time
  - Zone 2 (60-70%): 35% of workout time  
  - Zone 3 (70-80%): 25% of workout time
  - Zone 4 (80-90%): 10% of workout time
  - Zone 5 (90-100%): 2% of workout time

RECOVERY METRICS:
Resting Heart Rate: 58 bpm (Excellent)
HRV (Heart Rate Variability): 45 ms (Good)
Sleep Quality Score: 82/100 (Good)
Average Sleep Duration: 7h 23min
REM Sleep: 1h 45min (24% of sleep)
Deep Sleep: 1h 12min (16% of sleep)

BODY MEASUREMENTS:
Weight: 128.4 lbs (stable)
Body Fat: 18.2% (Athletic range)
Muscle Mass: 104.8 lbs
Hydration Level: 58% (Good)
`;
                } else {
                    // Default comprehensive lab panel
                    simulatedText = `
COMPREHENSIVE METABOLIC PANEL + LIPIDS
Patient Information: Robert Kim
Date of Birth: 05/10/1978
Medical Record #: MR-445789
Address: 321 Maple Drive, Austin, TX 73301
Insurance: Blue Cross PPO

Collection Date: September 1, 2024
Received: September 1, 2024 10:30 AM
Reported: September 2, 2024 8:15 AM
Fasting Status: 14 hours

LIPID PANEL:
Total Cholesterol: 285 mg/dL (Desirable: <200)
HDL Cholesterol: 32 mg/dL (Low: <40 M, <50 F) 
LDL Cholesterol: 195 mg/dL (Optimal: <100)
Triglycerides: 290 mg/dL (Normal: <150)
Non-HDL Cholesterol: 253 mg/dL (Optimal: <130)
Cholesterol/HDL Ratio: 8.9 (Optimal: <5.0)

GLUCOSE METABOLISM:
Glucose, Fasting: 118 mg/dL (Normal: 70-99)
Hemoglobin A1c: 6.2% (Pre-diabetic: 5.7-6.4%)
Insulin: 15.2 ŒºU/mL (Normal: 2.6-24.9)

KIDNEY FUNCTION:
Creatinine: 1.2 mg/dL (Normal: 0.7-1.3)
BUN: 22 mg/dL (Normal: 6-24)
eGFR: 68 mL/min/1.73m¬≤ (Normal: >60)

LIVER FUNCTION:
ALT: 45 U/L (Normal: 7-56)
AST: 38 U/L (Normal: 10-40) 
Total Bilirubin: 1.1 mg/dL (Normal: 0.3-1.2)

INFLAMMATORY MARKERS:
CRP (High Sensitivity): 4.8 mg/L (Low Risk: <1.0)
ESR: 28 mm/hr (Normal: 0-22)

VITAMINS & MINERALS:
Vitamin D, 25-OH: 18 ng/mL (Deficient: <30)
Vitamin B12: 450 pg/mL (Normal: 232-1245)
Folate: 8.2 ng/mL (Normal: >3.0)
Iron: 65 Œºg/dL (Normal: 65-175)
Ferritin: 45 ng/mL (Normal: 12-300)
`;
                }
                
                // Step 3: Display extracted content
                processingSteps.innerHTML += '<br>‚úÖ Step 3: Text extraction complete';
                documentPreview.style.display = 'block';
                documentContent.innerHTML = `<pre style="white-space: pre-wrap; font-size: 12px; max-height: 200px; overflow-y: auto;">${simulatedText}</pre>`;
                
                // Step 4: Smart AI-powered extraction
                processingSteps.innerHTML += '<br>‚è≥ Step 4: AI analyzing document for ALL health parameters...';
                
                const extractionResponse = await fetch('/api/extract', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ documentText: simulatedText })
                });
                
                const extractionData = await extractionResponse.json();
                
                if (extractionData.success) {
                    const extracted = extractionData.extractedData;
                    
                    // Step 5: Show intelligent extraction results
                    processingSteps.innerHTML += '<br>‚úÖ Step 5: Smart extraction complete - found ' + (extracted.totalParametersFound || extracted.healthParameters?.length || 0) + ' health parameters';
                    
                    sanitizationLog.style.display = 'block';
                    
                    // Show what personal data was identified and removed
                    let personalDataLog = '';
                    if (extracted.personalDataFound && extracted.personalDataFound.length > 0) {
                        personalDataLog = `
PERSONAL IDENTIFIERS DETECTED & REMOVED:
${extracted.personalDataFound.map(item => `‚ùå ${item.charAt(0).toUpperCase() + item.slice(1)} ‚Üí [REMOVED]`).join('\n')}

`;
                    }
                    
                    // Show extracted health parameters
                    let healthParamsLog = '';
                    if (extracted.healthParameters && extracted.healthParameters.length > 0) {
                        healthParamsLog = `HEALTH PARAMETERS EXTRACTED (Anonymous):
${extracted.healthParameters.map(param => 
    `‚úÖ ${param.parameter}: ${param.value}${param.unit ? ' ' + param.unit : ''} ${param.referenceRange ? '(Ref: ' + param.referenceRange + ')' : ''}`
).join('\n')}`;
                    } else if (extracted.rawAIResponse) {
                        healthParamsLog = `AI EXTRACTION RESULT:\n${extracted.rawAIResponse}`;
                    }
                    
                    sanitizationSteps.innerHTML = `
${personalDataLog}
${healthParamsLog}

üìä DOCUMENT TYPE: ${extracted.documentType || 'Unknown'}
üìÖ TEST DATE: ${extracted.testDate || 'Not specified'}
üîç TOTAL PARAMETERS FOUND: ${extracted.totalParametersFound || extracted.healthParameters?.length || 0}
ü§ñ EXTRACTION METHOD: AI-Powered Dynamic Recognition
                    `;
                    
                    // Step 6: Format for analysis
                    let healthDataForAnalysis = '';
                    if (extracted.healthParameters && extracted.healthParameters.length > 0) {
                        healthDataForAnalysis = extracted.healthParameters.map(param => 
                            `${param.parameter}: ${param.value}${param.unit ? ' ' + param.unit : ''}`
                        ).join('\n');
                    } else if (extracted.rawAIResponse) {
                        healthDataForAnalysis = extracted.rawAIResponse;
                    }
                    
                    if (healthDataForAnalysis.trim()) {
                        // Step 7: Analyze with AI
                        processingSteps.innerHTML += '<br>‚è≥ Step 6: Sending anonymous health data to AI for comprehensive analysis...';
                        await analyzeExtractedData(healthDataForAnalysis, `Document Type: ${extracted.documentType || 'Health Report'}`);
                    } else {
                        throw new Error('No health parameters could be extracted from this document');
                    }
                    
                } else {
                    throw new Error('Failed to extract health parameters: ' + extractionData.error);
                }
                
            } catch (error) {
                processingSteps.innerHTML += `<br>‚ùå Error: ${error.message}`;
                document.getElementById('documentResult').innerHTML = `
                    <div class="error">
                        <h3>‚ùå Processing Error</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Note:</strong> This is a demo - real PDF processing would use PDF.js for actual document reading.</p>
                    </div>
                `;
            }
        }
        
        async function analyzeExtractedData(healthData, documentContext = '') {
            try {
                const startTime = Date.now();
                
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ healthData: documentContext + '\n\n' + healthData })
                });
                
                const data = await response.json();
                const processingTime = ((Date.now() - startTime) / 1000).toFixed(2);
                
                if (data.success) {
                    document.getElementById('documentResult').innerHTML = `
                        <div class="result">
                            <h3>‚úÖ AI Health Analysis Complete</h3>
                            <div class="analysis-content">${data.analysis}</div>
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; font-size: 14px; color: #666;">
                                <strong>Source:</strong> Smart Document Analysis (AI-Powered Parameter Extraction)<br>
                                <strong>Privacy:</strong> Personal identifiers removed before AI processing<br>
                                <strong>Model:</strong> ${data.model} | 
                                <strong>Processing Time:</strong> ${processingTime}s | 
                                <strong>Generated:</strong> ${new Date(data.timestamp).toLocaleTimeString()}
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error(data.error);
                }
                
            } catch (error) {
                document.getElementById('documentResult').innerHTML = `
                    <div class="error">
                        <h3>‚ùå Analysis Error</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        // Manual entry analysis (existing function)
        async function testAI() {
            const healthData = document.getElementById('healthData').value;
            const resultDiv = document.getElementById('result');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            if (!healthData.trim()) {
                alert('Please enter some health data to analyze');
                return;
            }
            
            // Disable button and show loading
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = 'ü§ñ Analyzing...';
            
            resultDiv.innerHTML = `
                <div class="loading">
                    üß† AI is analyzing your health data using Llama 3.1-8B...<br>
                    <small>Processing on Cloudflare edge servers worldwide</small>
                </div>
            `;
            
            try {
                const startTime = Date.now();
                
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ healthData })
                });
                
                const data = await response.json();
                const processingTime = ((Date.now() - startTime) / 1000).toFixed(2);
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result">
                            <h3>‚úÖ AI Health Analysis Complete</h3>
                            <div class="analysis-content">${data.analysis}</div>
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; font-size: 14px; color: #666;">
                                <strong>Model:</strong> ${data.model} | 
                                <strong>Processing Time:</strong> ${processingTime}s | 
                                <strong>Generated:</strong> ${new Date(data.timestamp).toLocaleTimeString()}
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Analysis Error</h3>
                            <p><strong>Error:</strong> ${data.error}</p>
                            <p><strong>Details:</strong> ${data.details || 'Please check your configuration'}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Network Error</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            } finally {
                // Re-enable button
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = 'üß† Analyze Health Data';
            }
        }
    </script>
</body>
</html>
